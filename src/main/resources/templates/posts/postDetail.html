<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <th:block th:replace="fragments/header :: my-header('Posts')">
    </th:block>
    <script src="https://pagecdn.io/lib/ace/1.4.5/ace.js"
            integrity="sha256-5Xkhn3k/1rbXB+Q/DX/2RuAtaB4dRRyQvMs83prFjpM=" crossorigin="anonymous"></script>
    <script src="/ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>

</head>
<body>
<th:block th:replace="fragments/navbar :: top-nav"/>

<div class="container">
    <th:block th:replace="fragments/sidebar"/>
    <div class="card">
        <div class="card-header" th:text="${post.title}"></div>
        <div class="card-body">

            <blockquote class="blockquote mb-0">
                <p th:text="${post.body}"></p>
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-7">
                            <img th:if="${post.photo != null}" th:src="${post.photo}"/>
                        </div>
                    </div>
                </div>
                <footer class="blockquote-footer" th:text="${post.owner.username}">username</footer>
                <footer class="blockquote-footer" th:text="${post.owner.title}"></footer>
                <footer class="blockquote-footer"
                        th:text="${post.getCreatedAt().getMonth()}+'/'+${post.getCreatedAt().getDay()} + '/2019'"></footer>
            </blockquote>


            <!-- modal button-->
            <div sec:authorize="isAuthenticated()">
                <button id="commentBtn" type="button" class="btn btn-primary" data-toggle="modal"
                        data-target="#exampleModal">
                    Add Comment
                </button>
            </div>

            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Say Something Helpful!</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!--                    <div class="container" sec:authorize="isAuthenticated()">-->
                            <form th:action="@{/posts/comment}" method="post" th:object="${comment}">
                                <div class="input-group">
                                    <div class="input-group-prepend"></div>
                                    <textarea class="form-control" th:field="*{body}"
                                              aria-label="With textarea"></textarea>
                                    <input type="hidden" name="post.id" th:value="${post.id}"/>
                                    <button type="submit">Comment</button>
                                </div>
                            </form>
                            <!--                    </div>-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div><!--comments-->
    <br/>
    <div class="container">
        <div th:each="comment : ${comments}">
            <div class="row">
                <div class="col-lg-8">
                    <div th:text="${comment.user.username}"></div>
                </div>

            </div>
            <div class="row">
                <div class="col col-lg-2">
                    <img th:if="${comment.user.photo != null}" th:src="${comment.user.photo}" class="img-thumbnail"/>
                    <br/></div>
                <div class="col-lg-8" th:text="${comment.body}"><br/></div>
                <div class="col">
                    <div th:text="${comment.ratingTota()} + ' likes'"></div>
                    <div sec:authorize="isAuthenticated()">
                        <form th:action="@{'/comment/rate'}" th:method="post" th:object="${rating}">
                            <input type="hidden" name="vote" th:value="1"/>
                            <input type="hidden" name="comment.id" th:value="${comment.id}"/>
                            <button class="btn btn-link"> Like</button>
                        </form>
                        <form th:action="@{'/comment/rate'}" th:method="post" th:object="${rating}">
                            <input type="hidden" name="vote" th:value="0"/>
                            <input type="hidden" name="comment.id" th:value="${comment.id}"/>
                            <button class="btn btn-link"> Unlike</button>
                        </form>
                    </div>
                    <div sec:authorize="isAuthenticated()" th:if="${#authentication.principal.id} == ${comment.user.id}"
                         class="field is-grouped">
                        <ul class="nav nav-pills">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button"
                                   aria-haspopup="true" aria-expanded="false">More</a>
                                <div class="dropdown-menu">
                                    <form th:action="@{'/comment/' + ${comment.id} + '/edit'}" th:method="get"
                                          th:object="${comment}">
                                        <button class="btn btn-link btn-sm">Edit</button>
                                    </form>
                                    <form th:action="@{'/comment/' + ${comment.id} + '/delete'}" th:method="post"
                                          th:object="${comment}">
                                        <button class="btn btn-link btn-sm">Delete</button>
                                    </form>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <br/>
        </div>
    </div>
</div>


<div sec:authorize="isAuthenticated()">
    <form th:action="@{'/comment/rate'}" th:method="post" th:object="${rating}">
        <input type="hidden" name="vote" th:value="1"/>
        <input type="hidden" name="comment.id" th:value="${comment.id}"/>
        <button class="btn btn-success">Up</button>
    </form>
    <form th:action="@{'/comment/rate'}" th:method="post" th:object="${rating}">
        <input type="hidden" name="vote" th:value="0"/>
        <input type="hidden" name="comment.id" th:value="${comment.id}"/>
        <button class="btn btn-danger">Down</button>
    </form>
</div>


<th:block th:replace="fragments/bootstrapjs :: bootstrap-script">
</th:block>
</body>
</html>
